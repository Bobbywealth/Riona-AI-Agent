<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riona - Instagram Automation</title>
    <style>
        :root {
            --sidebar-bg: #2d2d3a;
            --sidebar-hover: #3d3d4a;
            --sidebar-active: #4a4a5a;
            --main-bg: #f5f5f5;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
            --accent: #c0392b;
            --accent-light: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --border: #e0e0e0;
            --toggle-on: #27ae60;
            --toggle-off: #c0392b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--main-bg);
            min-height: 100vh;
            display: flex;
        }
        
        /* Sidebar */
        .sidebar {
            width: 200px;
            background: var(--sidebar-bg);
            min-height: 100vh;
            padding: 20px 0;
            flex-shrink: 0;
        }
        
        .profile-section {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            border: 3px solid rgba(255,255,255,0.2);
        }
        
        .profile-name {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }
        
        .profile-status {
            color: var(--success);
            font-size: 11px;
            margin-top: 4px;
        }
        
        .profile-status.offline {
            color: var(--accent);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 12px 25px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: var(--sidebar-hover);
            color: white;
        }
        
        .nav-item.active {
            background: var(--sidebar-active);
            color: white;
            border-left-color: var(--accent);
        }
        
        .nav-icon {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        /* Status Bar */
        .status-bar {
            background: white;
            padding: 12px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        
        .countdown {
            color: var(--success);
            font-weight: 600;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        /* Buttons */
        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            width: 100%;
        }
        
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-sm { padding: 8px 12px; font-size: 13px; }
        .btn-full { width: 100%; margin-top: 10px; }
        
        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            margin: 8px 0;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            font-weight: 500;
        }
        
        .status-message.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 15px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .loading.active {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Logs */
        .log-container {
            background: var(--dark);
            color: #d1d5db;
            padding: 20px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .ai-chat-log {
            background: #0f172a;
            color: #e5e7eb;
            border-radius: 12px;
            padding: 14px;
            height: 260px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid #1f2937;
        }

        .ai-chat-bubble {
            padding: 10px 12px;
            border-radius: 10px;
            line-height: 1.4;
            font-size: 0.95rem;
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.25);
        }

        .ai-chat-bubble.user {
            background: #eef2ff;
            color: #1f2937;
            align-self: flex-end;
        }

        .ai-chat-bubble.assistant {
            background: #111827;
            color: #e5e7eb;
            border: 1px solid #1f2937;
        }

        .ai-chat-input {
            display: flex;
            gap: 12px;
            margin-top: 14px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            font-size: 0.95rem;
        }

        .ai-log-snippet {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
            color: #cbd5f5;
        }
        
        .log-entry {
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid #6b7280;
        }
        
        .log-entry.log-success {
            color: #10b981;
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .log-entry.log-error {
            color: #ef4444;
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .log-entry.log-warning {
            color: #f59e0b;
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        
        .log-entry.log-info {
            color: #3b82f6;
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .log-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .log-container::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 10px;
        }
        
        .log-container::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 10px;
        }
        
        /* Collapsible Sections */
        .collapsible {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--light);
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
            font-size: 13px;
        }
        
        .collapsible-header:hover { background: #e5e7eb; }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.active {
            max-height: 500px;
        }
        
        .arrow {
            transition: transform 0.3s;
            font-size: 12px;
        }
        
        .arrow.active { transform: rotate(180deg); }
        
        /* Status Messages */
        .status-message {
            background: #fff3cd;
            color: #856404;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 13px;
            flex: 1;
            margin: 0 20px;
            text-align: center;
        }
        
        .logout-btn {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            color: var(--accent);
        }
        
        /* Content Area */
        .content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .center-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        /* Right Sidebar */
        .right-sidebar {
            width: 280px;
            background: white;
            border-left: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
        }
        
        .activity-section {
            margin-bottom: 25px;
        }
        
        .activity-title {
            color: var(--accent);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 13px;
            color: var(--text-primary);
        }
        
        .activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .activity-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Stats Card */
        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stats-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .stats-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
        }
        
        /* Chart placeholder */
        .chart-area {
            height: 150px;
            background: linear-gradient(to right, #f8f8f8, #fff);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 14px;
            border: 1px dashed var(--border);
            margin-bottom: 20px;
        }
        
        /* Controls Card */
        .controls-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .control-row {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .control-row:last-child {
            border-bottom: none;
        }
        
        .control-label {
            width: 100px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .control-toggle {
            margin-right: 20px;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-off);
            transition: 0.3s;
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--toggle-on);
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        .control-count {
            width: 60px;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
        }
        
        .control-slider-wrap {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-slider-label {
            font-size: 12px;
            color: var(--text-muted);
            white-space: nowrap;
        }
        
        .control-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
        }
        
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4a90d9;
            cursor: pointer;
        }
        
        .control-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4a90d9;
            cursor: pointer;
            border: none;
        }
        
        /* Speed Controls */
        .speed-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .speed-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            background: #e0e0e0;
            color: var(--text-secondary);
        }
        
        .speed-btn:hover {
            background: #d0d0d0;
        }
        
        .speed-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* Target Inputs */
        .targets-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .target-group h4 {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .target-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .target-input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .hashtag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .hashtag-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f0f0f0;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .hashtag-remove {
            cursor: pointer;
            color: var(--accent);
            font-weight: bold;
        }
        
        /* Login Card */
        .login-card {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 400px;
            margin: 40px auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .login-card h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-primary);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 13px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .login-btn:hover {
            background: #219a52;
        }
        
        .login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* Logs Section */
        .logs-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logs-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .log-filter-btn {
            padding: 6px 14px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .log-filter-btn:hover {
            background: #f5f5f5;
        }
        
        .log-filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .logs-list {
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            background: #1e1e1e;
            border-radius: 6px;
            padding: 15px;
        }
        
        .log-entry {
            padding: 6px 0;
            border-bottom: 1px solid #333;
            color: #d4d4d4;
            display: flex;
            gap: 10px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #888;
            flex-shrink: 0;
        }
        
        .log-level {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .log-level.info { background: #0d47a1; color: white; }
        .log-level.warn { background: #f57c00; color: white; }
        .log-level.error { background: #c62828; color: white; }
        .log-level.debug { background: #455a64; color: white; }
        
        .log-message {
            flex: 1;
            word-break: break-word;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* Loading spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .right-sidebar {
                width: 220px;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 60px;
            }
            .profile-section {
                padding: 10px;
            }
            .profile-pic {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            .profile-name, .profile-status {
                display: none;
            }
            .nav-item {
                padding: 12px;
                justify-content: center;
            }
            .nav-item span:not(.nav-icon) {
                display: none;
            }
            .right-sidebar {
                display: none;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .targets-row {
                grid-template-columns: 1fr;
            }
            .control-row {
                flex-wrap: wrap;
                gap: 10px;
            }
            .control-slider-wrap {
                width: 100%;
            }
        }
        
        /* Chat bubble */
        .chat-bubble {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        
        .chat-bubble:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Compact Header with Status Indicators -->
        <div class="header">
            <h1><span>ü§ñ</span> Instagram Bot</h1>
            <div class="status-indicators">
                <div id="loginStatus" class="status-pill offline">
                    <div class="pulse"></div>
                    <span>Checking...</span>
                </div>
                
                <!-- Login Form (shown when logged out) -->
                <div id="loginForm">
                    <div class="form-group">
                        <label>Instagram Username</label>
                        <input type="text" id="loginUsername" placeholder="your_username">
                    </div>
                    <div class="form-group">
                        <label>Instagram Password</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="rememberMeCheckbox" checked>
                        <label style="margin: 0;">Remember me for 30 days</label>
                    </div>
                    <button class="btn-success" onclick="login()">üîì Login</button>
                </div>
                
                <!-- Logged In Controls (shown when logged in) -->
                <div id="loggedInControls" class="hidden">
                    <button class="btn-danger" onclick="logout()">üö™ Logout</button>
                    <button class="btn-secondary" onclick="clearCookies()">üßπ Clear Cookies</button>
                </div>
                
                <div class="loading" id="loadingLogin">
                    <div class="spinner"></div>
                    <span>Processing...</span>
                </div>
                <div id="loginStatus" class="status-message info mt-2">
                    ‚ÑπÔ∏è Checking status...
                </div>
            </div>
            
            <!-- Proxy Configuration -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üåê</div>
                    <h2>Proxy Settings</h2>
                </div>
                <div class="status-message info mb-2">
                    ‚ÑπÔ∏è Using a proxy helps avoid Instagram rate limits and IP blocks
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="proxyEnabled">
                    <label style="margin: 0;">Enable Proxy</label>
                </div>
                <div id="proxyFields" class="hidden">
                    <div class="form-group">
                        <label>Proxy Host</label>
                        <input type="text" id="proxyHost" placeholder="proxy.example.com">
                    </div>
                    <div class="form-group">
                        <label>Proxy Port</label>
                        <input type="number" id="proxyPort" placeholder="8080">
                    </div>
                    <div class="form-group">
                        <label>Proxy Username (optional)</label>
                        <input type="text" id="proxyUsername" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>Proxy Password (optional)</label>
                        <input type="password" id="proxyPassword" placeholder="password">
                    </div>
                    <button class="btn-primary" onclick="saveProxySettings()">üíæ Save Proxy Settings</button>
                </div>
                <div class="loading hidden" id="loadingProxy">
                    <div class="spinner"></div>
                    <span>Saving...</span>
                </div>
                <div id="proxyStatus" class="status-message info mt-2 hidden">
                    ‚ÑπÔ∏è Proxy status
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">‚ö°</div>
                    <h2>Lead Generation</h2>
                </div>
                <div class="form-group">
                    <label>Targeting Mode</label>
                    <select id="interactionMode" onchange="updateInteractionFields()">
                        <option value="feed">Recent Feed</option>
                        <option value="explore">Explore Page</option>
                        <option value="hashtag">Hashtag Search</option>
                        <option value="location">Location Search</option>
                        <option value="user">Specific User</option>
                        <option value="competitor_followers">Competitor Followers</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Max Posts to Process</label>
                    <input type="number" id="maxPostsInput" value="10" min="1" max="100">
                </div>
                
                <!-- Dynamic Fields -->
                <div id="targetUsernameGroup" class="form-group hidden">
                    <label>Target Username</label>
                    <input type="text" id="interactionTarget" placeholder="username (no @)">
                </div>
                <div id="hashtagGroup" class="form-group hidden">
                    <label>Hashtags (comma separated)</label>
                    <input type="text" id="interactionHashtags" placeholder="restaurant, miami, food">
                </div>
                <div id="locationGroup" class="form-group hidden">
                    <label>Location Path</label>
                    <input type="text" id="locationPath" placeholder="212941492/miami-florida">
                </div>
                <div id="competitorGroup" class="form-group hidden">
                    <label>Competitor Username</label>
                    <input type="text" id="competitorUsername" placeholder="competitor_username">
                </div>
                
                <!-- Advanced Options -->
                <div class="collapsible" onclick="toggleCollapsible('advancedOptions')">
                    <span>‚öôÔ∏è Advanced Filters</span>
                    <span class="arrow" id="advancedOptionsArrow">‚ñº</span>
                </div>
                <div id="advancedOptions" class="collapsible-content">
                    <div class="form-group">
                        <label>Min Likes (optional)</label>
                        <input type="number" id="minLikesInput" placeholder="e.g., 50">
                    </div>
                    <div class="form-group">
                        <label>Min Comments (optional)</label>
                        <input type="number" id="minCommentsInput" placeholder="e.g., 5">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="englishOnlyCheckbox" checked>
                        <label style="margin: 0;">English captions only</label>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="startCommenting()">üöÄ Start Campaign</button>
                <button class="btn-info" onclick="checkStatus()">üìä Check Status</button>
                <div class="loading" id="loading1">
                    <div class="spinner"></div>
                    <span>Running campaign...</span>
                </div>
            </div>
            
            <!-- Story Viewer -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üì∫</div>
                    <h2>Story Engagement</h2>
                </div>
                <div class="form-group">
                    <label>Stories to Watch</label>
                    <input type="number" id="storyCount" value="10" min="1" max="50">
                </div>
                <div class="form-group">
                    <label>Target User (optional)</label>
                    <input type="text" id="storyTarget" placeholder="Leave empty for feed">
                </div>
                <div class="flex gap-2">
                    <div class="form-group" style="flex: 1;">
                        <label>Like % (0-100)</label>
                        <input type="number" id="storyLikeProbability" value="30" min="0" max="100">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>React % (0-100)</label>
                        <input type="number" id="storyReactionProbability" value="20" min="0" max="100">
                    </div>
                </div>
                <div class="form-group">
                    <label>Reaction Emoji</label>
                    <input type="text" id="storyReactionEmoji" value="üî•" maxlength="2">
                </div>
                <div class="flex gap-2">
                    <div class="form-group" style="flex: 1;">
                        <label>Min Watch (sec)</label>
                        <input type="number" id="storyMinWatch" value="5" min="2">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Max Watch (sec)</label>
                        <input type="number" id="storyMaxWatch" value="9" min="3">
                    </div>
                </div>
                <div class="card-divider"></div>
                <div class="checkbox-group">
                    <input type="checkbox" id="storyAiReplyEnabled">
                    <label style="margin: 0;">Enable AI story replies (Gemini-powered)</label>
                </div>
                <div id="storyAiOptions" class="hidden">
                    <div class="form-group">
                        <label>Max AI Replies per Session</label>
                        <input type="number" id="storyAiMaxReplies" value="3" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label>Reply Tone</label>
                        <select id="storyAiTone">
                            <option value="friendly">Friendly + warm</option>
                            <option value="consultative">Consultative / advisor</option>
                            <option value="hype">High-energy / hype</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Confidence Threshold (%)</label>
                        <input type="number" id="storyAiConfidence" value="55" min="10" max="100">
                        <small style="display:block;color:#6b7280;margin-top:4px;">Only reply when Gemini confidence exceeds this level.</small>
                    </div>
                </div>
                <button class="btn-primary" onclick="watchStories()">üëÅÔ∏è Watch Stories</button>
                <div class="loading" id="loadingStories">
                    <div class="spinner"></div>
                    <span>Watching stories...</span>
                </div>
            </div>
            <span class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">Logout</span>
        </div>

        <div class="content-wrapper">
            <!-- Center Content -->
            <div class="center-content">
                <!-- Dashboard Section -->
                <div id="section-dashboard" class="section active">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number" id="statFollows">0</div>
                            <div class="stat-label">Follows Today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statLikes">0</div>
                            <div class="stat-label">Likes Today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statComments">0</div>
                            <div class="stat-label">Comments Today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statStories">0</div>
                            <div class="stat-label">Stories Viewed</div>
                        </div>
                    </div>
                    
                    <div class="chart-area" id="chartArea">
                        üìà Follower growth chart will appear here after activity
                    </div>
                    
                    <div class="controls-card">
                        <div class="control-row">
                            <span class="control-label">Follow</span>
                            <label class="toggle-switch control-toggle">
                                <input type="checkbox" id="toggleFollow" onchange="updateControl('follow')">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="control-count" id="countFollow">0</span>
                            <div class="control-slider-wrap">
                                <span class="control-slider-label">Follows/day:</span>
                                <input type="range" class="control-slider" id="sliderFollow" min="10" max="200" value="100">
                                <span id="sliderFollowVal">100</span>
                            </div>
                        </div>
                        
                        <div class="control-row">
                            <span class="control-label">DM</span>
                            <label class="toggle-switch control-toggle">
                                <input type="checkbox" id="toggleDM" onchange="updateControl('dm')">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="control-count" id="countDM">0</span>
                            <div class="control-slider-wrap">
                                <span class="control-slider-label">DMs/day:</span>
                                <input type="range" class="control-slider" id="sliderDM" min="5" max="50" value="10">
                                <span id="sliderDMVal">10</span>
                            </div>
                        </div>
                        
                        <div class="control-row">
                            <span class="control-label">Unfollow</span>
                            <label class="toggle-switch control-toggle">
                                <input type="checkbox" id="toggleUnfollow" onchange="updateControl('unfollow')">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="control-count" id="countUnfollow">0</span>
                            <div class="control-slider-wrap">
                                <span class="control-slider-label">Unfollows/day:</span>
                                <input type="range" class="control-slider" id="sliderUnfollow" min="10" max="200" value="100">
                                <span id="sliderUnfollowVal">100</span>
                            </div>
                        </div>
                        
                        <div class="control-row">
                            <span class="control-label">Like</span>
                            <label class="toggle-switch control-toggle">
                                <input type="checkbox" id="toggleLike" checked onchange="updateControl('like')">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="control-count" id="countLike">0</span>
                            <div class="control-slider-wrap">
                                <span class="control-slider-label">Likes/day:</span>
                                <input type="range" class="control-slider" id="sliderLike" min="20" max="300" value="100">
                                <span id="sliderLikeVal">100</span>
                            </div>
                        </div>
                        
                        <div class="control-row">
                            <span class="control-label">Stories</span>
                            <label class="toggle-switch control-toggle">
                                <input type="checkbox" id="toggleStories" checked onchange="updateControl('stories')">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="control-count" id="countStories">0</span>
                            <div class="control-slider-wrap">
                                <span class="control-slider-label">Stories/day:</span>
                                <input type="range" class="control-slider" id="sliderStories" min="50" max="500" value="200">
                                <span id="sliderStoriesVal">200</span>
                            </div>
                        </div>
                        
                        <div class="speed-controls">
                            <button class="speed-btn" onclick="setSpeed('slow')">Slow</button>
                            <button class="speed-btn active" onclick="setSpeed('medium')">Medium</button>
                            <button class="speed-btn" onclick="setSpeed('fast')">Fast</button>
                        </div>
                    </div>
                </div>
                
                <!-- Automation Section -->
                <div id="section-automation" class="section" style="display: none;">
                    <div class="controls-card">
                        <h3 style="margin-bottom: 20px; color: var(--text-primary);">ü§ñ Automation Actions</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button class="login-btn" onclick="startInteraction('like')" style="background: #3498db;">
                                ‚ù§Ô∏è Start Liking
                            </button>
                            <button class="login-btn" onclick="startInteraction('comment')" style="background: #9b59b6;">
                                üí¨ Start Commenting
                            </button>
                            <button class="login-btn" onclick="startInteraction('follow')" style="background: #27ae60;">
                                üë• Start Following
                            </button>
                            <button class="login-btn" onclick="viewStories()" style="background: #e67e22;">
                                üìñ View Stories
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">Campaign Settings</h4>
                            <div class="form-group">
                                <label>Target Username</label>
                                <input type="text" id="targetUsername" placeholder="@username to interact with their followers">
                            </div>
                            <div class="form-group">
                                <label>Max Posts to Process</label>
                                <input type="number" id="maxPosts" value="10" min="1" max="50">
                            </div>
                            <button class="login-btn" onclick="startCampaign()" style="margin-top: 10px;">
                                üöÄ Start Campaign
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Targeting Section -->
                <div id="section-targeting" class="section" style="display: none;">
                    <div class="controls-card">
                        <h3 style="margin-bottom: 20px; color: var(--text-primary);">üéØ Targeting Options</h3>
                        
                        <div class="targets-row">
                            <div class="target-group">
                                <h4>Target Accounts</h4>
                                <input type="text" class="target-input" id="targetAccounts" placeholder="Enter username and press Enter">
                                <div class="hashtag-list" id="accountsList"></div>
                            </div>
                            <div class="target-group">
                                <h4>Target Hashtags</h4>
                                <input type="text" class="target-input" id="targetHashtags" placeholder="Enter hashtag and press Enter">
                                <div class="hashtag-list" id="hashtagsList">
                                    <div class="hashtag-tag">
                                        <span>#</span>
                                        <span>dogs</span>
                                        <span class="hashtag-remove" onclick="removeHashtag(this)">√ó</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">Follower Filters</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Min Followers</label>
                                    <input type="number" id="minFollowers" value="100" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Max Followers</label>
                                    <input type="number" id="maxFollowers" value="10000" min="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Section -->
                <div id="section-analytics" class="section" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number">-</div>
                            <div class="stat-label">Total Followers</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">-</div>
                            <div class="stat-label">Total Following</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">-</div>
                            <div class="stat-label">Posts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">-</div>
                            <div class="stat-label">Engagement Rate</div>
                        </div>
                    </div>
                    
                    <div class="controls-card">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <p>Login to view your Instagram analytics</p>
                        </div>
                    </div>
                </div>
                
                <!-- Logs Section -->
                <div id="section-logs" class="section" style="display: none;">
                    <div class="logs-container">
                        <div class="logs-header">
                            <div class="logs-filters">
                                <button class="log-filter-btn active" onclick="filterLogs('all')">All</button>
                                <button class="log-filter-btn" onclick="filterLogs('info')">Info</button>
                                <button class="log-filter-btn" onclick="filterLogs('warn')">Warning</button>
                                <button class="log-filter-btn" onclick="filterLogs('error')">Error</button>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="log-filter-btn" onclick="refreshLogs()">üîÑ Refresh</button>
                                <button class="log-filter-btn" onclick="downloadLogs()">‚¨áÔ∏è Download</button>
                            </div>
                        </div>
                        <div class="logs-list" id="logsList">
                            <div class="log-entry">
                                <span class="log-time">--:--:--</span>
                                <span class="log-level info">INFO</span>
                                <span class="log-message">Loading logs...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div id="section-settings" class="section" style="display: none;">
                    <div class="login-card" id="loginCard">
                        <h2>üîê Instagram Login</h2>
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="loginUsername" placeholder="Your Instagram username">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="rememberMeCheckbox" checked>
                            <label>Remember me for 7 days</label>
                        </div>
                        <button class="btn-success btn-full" onclick="login()">üîì Login</button>
                    </div>
                    
                    <div id="loggedInControls" class="hidden">
                        <div class="status-message success">‚úÖ Logged in successfully</div>
                        <button class="btn-danger btn-full" onclick="logout()">üö™ Logout</button>
                        <button class="btn-secondary btn-full" onclick="clearCookies()">üßπ Clear Cookies</button>
                    </div>
                    
                    <div class="loading" id="loadingLogin">
                        <div class="spinner"></div>
                        <span>Connecting...</span>
                    </div>
                </div>
                <button class="btn-primary" onclick="monitorDMs()">üì¨ Monitor & Auto-Reply</button>
                <button class="btn-info" onclick="clearDMCache()">üóëÔ∏è Clear Reply Cache</button>
                <div class="collapsible mt-2" onclick="toggleCollapsible('sendDMSection')">
                    <span>üì© Send Manual DM</span>
                    <span class="arrow" id="sendDMSectionArrow">‚ñº</span>
                </div>
            </div>
        </div>
        
        <!-- CAMPAIGNS TAB -->
        <div id="tab-campaigns" class="tab-content">
            <div class="card-grid">
                <!-- Lead Generation -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö°</div>
                        <h2>Lead Generation</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Targeting Mode</label>
                            <select id="interactionMode" onchange="updateInteractionFields()">
                                <option value="feed">Recent Feed</option>
                                <option value="explore">Explore Page</option>
                                <option value="hashtag">Hashtag Search</option>
                                <option value="location">Location Search</option>
                                <option value="user">Specific User</option>
                                <option value="competitor_followers">Competitor Followers</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="rememberMe" checked style="width: auto;">
                                Remember me for 7 days
                            </label>
                        </div>
                        <button class="login-btn" id="loginBtn" onclick="login()">
                            üîì Login to Instagram
                        </button>
                    </div>
                    
                    <div class="controls-card" style="margin-top: 20px;">
                        <h3 style="margin-bottom: 20px; color: var(--text-primary);">üåê Proxy Settings</h3>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="proxyEnabled" style="width: auto;">
                                Enable Proxy
                            </label>
                        </div>
                        <div id="proxyFields" style="display: none;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Proxy Host</label>
                                    <input type="text" id="proxyHost" placeholder="proxy.example.com">
                                </div>
                                <div class="form-group">
                                    <label>Port</label>
                                    <input type="text" id="proxyPort" placeholder="8080">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Username (optional)</label>
                                    <input type="text" id="proxyUsername" placeholder="proxy username">
                                </div>
                                <div class="form-group">
                                    <label>Password (optional)</label>
                                    <input type="password" id="proxyPassword" placeholder="proxy password">
                                </div>
                            </div>
                            <button class="login-btn" onclick="saveProxy()" style="background: #3498db;">
                                üíæ Save Proxy Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Activity Feed -->
            <div class="right-sidebar">
                <div class="activity-section">
                    <h3 class="activity-title">Viewed Stories</h3>
                    <div id="viewedStories">
                        <div class="empty-state" style="padding: 20px;">
                            <p style="font-size: 12px;">No stories viewed yet</p>
                        </div>
                        <button class="btn-info" onclick="scrapeFollowers()">üë• Scrape Followers</button>
                    </div>
                    
                    <div class="quick-actions mt-2">
                        <button class="btn-secondary btn-sm" onclick="checkScheduler()">‚è∞ Scheduler</button>
                        <button class="btn-secondary btn-sm" onclick="getMyProfile()">üë§ Profile</button>
                        <button class="btn-secondary btn-sm" onclick="checkStatus()">üìä Status</button>
                    </div>
                    
                    <div class="loading" id="loading4">
                        <div class="spinner"></div>
                        <span>Processing...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Command Console -->
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">ü§ñ</div>
                    <h2>AI Command Console</h2>
                </div>
                <div class="ai-chat-log" id="aiChatLog">
                    <div class="ai-chat-bubble assistant">
                        üëã Hi! I'm your automation copilot. Try asking me to run a Miami campaign, watch stories, or show the latest logs.
                    </div>
                </div>
                <div class="ai-chat-input">
                    <input type="text" id="aiCommandInput" placeholder="e.g. Run the Miami location campaign with 5 DMs">
                    <button class="btn-primary" onclick="sendAiCommand()">Send</button>
                </div>
                <div class="loading" id="aiChatLoading">
                    <div class="spinner"></div>
                    <span>Thinking...</span>
                </div>
            </div>
        </div>
        
        <!-- LOGS TAB -->
        <div id="tab-logs" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìú</div>
                    <h2>Activity Logs <span id="logCount" style="font-size: 14px; color: #667eea; font-weight: normal;"></span></h2>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn-primary" id="liveLogBtn" onclick="toggleLiveLog()">‚ñ∂Ô∏è Start Live Log</button>
                    <select id="logDetailLevel" onchange="viewLogs()" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <option value="all">All Logs (Detailed)</option>
                        <option value="important">Important Only</option>
                    </select>
                </div>
                
                <!-- Stats Bar -->
                <div class="log-stats" id="logStats">
                    <div class="stat-item" onclick="filterByLevel('all')">
                        <span class="stat-count" id="statTotal">0</span>
                        <span class="stat-label">Total</span>
                    </div>
                    <div class="stat-item stat-info" onclick="filterByLevel('info')">
                        <span class="stat-count" id="statInfo">0</span>
                        <span class="stat-label">Info</span>
                    </div>
                    <div class="stat-item stat-warn" onclick="filterByLevel('warn')">
                        <span class="stat-count" id="statWarn">0</span>
                        <span class="stat-label">Warnings</span>
                    </div>
                    <div class="stat-item stat-error" onclick="filterByLevel('error')">
                        <span class="stat-count" id="statError">0</span>
                        <span class="stat-label">Errors</span>
                    </div>
                </div>
                
                <div class="activity-section">
                    <h3 class="activity-title">Liked Posts</h3>
                    <div id="likedPosts">
                        <div class="empty-state" style="padding: 20px;">
                            <p style="font-size: 12px;">No posts liked yet</p>
                        </div>
                    </div>
                </div>
                
                <div class="activity-section">
                    <h3 class="activity-title">Followed Users</h3>
                    <div id="followedUsers">
                        <div class="empty-state" style="padding: 20px;">
                            <p style="font-size: 12px;">No users followed yet</p>
                        </div>
                    </div>
                </div>
                
                <div class="activity-section">
                    <h3 class="activity-title">Recent Comments</h3>
                    <div id="recentComments">
                        <div class="empty-state" style="padding: 20px;">
                            <p style="font-size: 12px;">No comments made yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Bubble -->
    <div class="chat-bubble" title="Need help?">üí¨</div>

    <script>
        const API_URL = window.location.origin;

        const aiChatHistory = [];

        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include'
                };
                if (body) options.body = JSON.stringify(body);
                const response = await fetch(API_URL + endpoint, options);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { error: error.message };
            }
        }
        
        // Log helper
        function addLog(message) {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            if (message.includes('‚úÖ')) entry.classList.add('log-success');
            else if (message.includes('‚ùå')) entry.classList.add('log-error');
            else if (message.includes('‚ö†Ô∏è')) entry.classList.add('log-warning');
            else if (message.includes('‚ÑπÔ∏è') || message.includes('üì°')) entry.classList.add('log-info');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.insertBefore(entry, logs.firstChild);
        }

        function appendAiMessage(role, text) {
            const container = document.getElementById('aiChatLog');
            if (!container) return;
            const bubble = document.createElement('div');
            bubble.className = `ai-chat-bubble ${role}`;
            bubble.innerHTML = text.replace(/\n/g, '<br>');
            container.appendChild(bubble);
            container.scrollTop = container.scrollHeight;
        }

        function toggleAiChatLoading(active) {
            const loading = document.getElementById('aiChatLoading');
            if (!loading) return;
            loading.classList.toggle('active', !!active);
        }

        async function sendAiCommand() {
            const input = document.getElementById('aiCommandInput');
            if (!input) return;
            const message = input.value.trim();
            if (!message.length) return;

            appendAiMessage('user', message);
            aiChatHistory.push({ role: 'user', content: message });
            input.value = '';
            toggleAiChatLoading(true);

            const payload = {
                message,
                history: aiChatHistory.slice(-6),
            };

            const result = await apiCall('/api/ai/command', 'POST', payload);
            toggleAiChatLoading(false);

            if (result.error) {
                appendAiMessage('assistant', `‚ùå ${result.error}`);
                aiChatHistory.push({ role: 'assistant', content: `Error: ${result.error}` });
                return;
            }

            const plan = result.plan || {};
            const execution = result.execution || {};
            const confidencePct = plan.confidence ? Math.round(plan.confidence * 100) : 0;
            const summaryLine = plan.summary
                ? `üß† ${plan.summary} (${confidencePct}% confidence)`
                : 'üß† Command interpreted.';
            const executionLine = execution.message
                ? `${execution.success ? '‚úÖ' : '‚ö†Ô∏è'} ${execution.message}`
                : 'No follow-up action was executed.';

            let detailsBlock = '';
            if (execution.details?.logs) {
                const snippet = execution.details.logs.slice(-5).join('<br>');
                detailsBlock = `<div class="ai-log-snippet">${snippet}</div>`;
            } else if (execution.details?.help) {
                detailsBlock = `<div class="ai-log-snippet">${execution.details.help.replace(/\n/g, '<br>')}</div>`;
            } else if (execution.details) {
                detailsBlock = `<div class="ai-log-snippet">${JSON.stringify(execution.details, null, 2)}</div>`;
            }

            appendAiMessage('assistant', `${summaryLine}<br>${executionLine}${detailsBlock ? `<br>${detailsBlock}` : ''}`);
            aiChatHistory.push({
                role: 'assistant',
                content: `${summaryLine}\n${executionLine}`,
            });
        }

        function toggleCollapsible(id) {
            const content = document.getElementById(id);
            const arrow = document.getElementById(id + 'Arrow');
            content.classList.toggle('active');
            arrow.classList.toggle('active');
        }

        function updateInteractionFields() {
            const mode = document.getElementById('interactionMode').value;
            document.getElementById('targetUsernameGroup').classList.add('hidden');
            document.getElementById('hashtagGroup').classList.add('hidden');
            document.getElementById('locationGroup').classList.add('hidden');
            document.getElementById('competitorGroup').classList.add('hidden');
            
            const statusEl = document.getElementById('profileStatus');
            const nameEl = document.getElementById('profileName');
            const picEl = document.getElementById('profilePic');
            const logoutBtn = document.getElementById('logoutBtn');
            const statusMsg = document.getElementById('statusMessage');
            
            if (isLoggedIn) {
                statusEl.textContent = 'Online';
                statusEl.classList.remove('offline');
                nameEl.textContent = '@' + (result.username || 'user');
                picEl.textContent = (result.username || 'U')[0].toUpperCase();
                logoutBtn.style.display = 'block';
                statusMsg.textContent = 'Bot is active and ready for automation.';
                statusMsg.style.background = '#d4edda';
                statusMsg.style.color = '#155724';
            } else {
                statusEl.textContent = 'Offline';
                statusEl.classList.add('offline');
                nameEl.textContent = 'Not logged in';
                picEl.textContent = 'R';
                logoutBtn.style.display = 'none';
                statusMsg.textContent = 'Go to Settings to login to Instagram.';
                statusMsg.style.background = '#fff3cd';
                statusMsg.style.color = '#856404';
            }
        }
        
        // Login
        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const remember = document.getElementById('rememberMe').checked;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Logging in...';
            
            document.getElementById('statusMessage').textContent = 'Logging in to Instagram... This may take a minute.';
            
            const result = await apiCall('/api/login', 'POST', { username, password, rememberMe: remember });
            
            btn.disabled = false;
            btn.textContent = 'üîì Login to Instagram';
            
            if (result.error) {
                alert('Login failed: ' + result.error);
                document.getElementById('statusMessage').textContent = 'Login failed: ' + result.error;
            } else {
                statusDiv.className = 'status-message success mt-2';
                statusDiv.innerHTML = `‚úÖ Logged in as @${result.username || username}`;
                addLog(`‚úÖ Successfully logged in as @${result.username || username}`);
                addLog(rememberMe ? 'üîí Session will last 30 days' : '‚è∞ Session will last 24 hours');
                document.getElementById('loginPassword').value = '';
                // Save username to localStorage for convenience
                if (rememberMe) {
                    localStorage.setItem('savedUsername', username);
                }
                checkStatus();
            }
        }
        
        // Logout
        async function logout() {
            if (!confirm('Are you sure you want to logout?')) return;
            await apiCall('/api/logout', 'POST');
            await checkStatus();
        }
        
        // Speed control
        function setSpeed(speed) {
            currentSpeed = speed;
            document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // Update slider values
        document.querySelectorAll('.control-slider').forEach(slider => {
            slider.addEventListener('input', function() {
                document.getElementById(this.id + 'Val').textContent = this.value;
            });
        });
        
        // Control toggles
        function updateControl(type) {
            const toggle = document.getElementById('toggle' + type.charAt(0).toUpperCase() + type.slice(1));
            console.log(type + ' is now:', toggle.checked ? 'ON' : 'OFF');
        }
        
        // Save proxy settings
        async function saveProxySettings() {
            const loading = document.getElementById('loadingProxy');
            loading.classList.add('active');
            
            const enabled = document.getElementById('proxyEnabled').checked;
            const host = document.getElementById('proxyHost').value.trim();
            const port = document.getElementById('proxyPort').value.trim();
            const username = document.getElementById('proxyUsername').value.trim();
            const password = document.getElementById('proxyPassword').value;
            
            const result = await apiCall('/api/proxy/configure', 'POST', { enabled, host, port, username, password });
            
            loading.classList.remove('active');
            if (result.error) {
                addLog('‚ùå Proxy error: ' + result.error);
            } else {
                addLog('‚úÖ Proxy settings saved');
                updateProxyStatusPill(enabled);
            }
        }
        
        function updateProxyStatusPill(enabled) {
            const pill = document.getElementById('proxyStatus');
            if (enabled) {
                pill.innerHTML = '<span>üåê</span><span>Proxy Active</span>';
                pill.className = 'status-pill online';
            } else {
                pill.innerHTML = '<span>üåê</span><span>No Proxy</span>';
                pill.className = 'status-pill';
            }
        }
        
        // Check status
        async function checkStatus() {
            const result = await apiCall('/api/status');
            const loginPill = document.getElementById('loginStatus');
            const loginForm = document.getElementById('loginForm');
            const loggedInControls = document.getElementById('loggedInControls');
            
            if (result.authenticated) {
                loginPill.className = 'status-pill online';
                loginPill.innerHTML = '<div class="pulse"></div><span>@' + (result.username || 'Online') + '</span>';
                loginForm.classList.add('hidden');
                loggedInControls.classList.remove('hidden');
            } else {
                loginPill.className = 'status-pill offline';
                loginPill.innerHTML = '<div class="pulse"></div><span>Offline</span>';
                loginForm.classList.remove('hidden');
                loggedInControls.classList.add('hidden');
            }
        }
        
        // Start commenting campaign
        async function startCommenting() {
            const loading = document.getElementById('loading1');
            loading.classList.add('active');
            
            const mode = document.getElementById('interactionMode').value;
            const maxPosts = parseInt(document.getElementById('maxPostsInput').value, 10) || 10;
            const targetInput = document.getElementById('interactionTarget').value.trim();
            const hashtagInput = document.getElementById('interactionHashtags').value;
            const locationPath = document.getElementById('locationPath').value.trim();
            const competitorUsername = document.getElementById('competitorUsername').value.trim();
            const minLikes = parseInt(document.getElementById('minLikesInput').value, 10);
            const minComments = parseInt(document.getElementById('minCommentsInput').value, 10);
            const englishOnly = document.getElementById('englishOnlyCheckbox').checked;
            
            const hashtags = hashtagInput.split(',').map(t => t.replace(/^#/, '').trim()).filter(Boolean);
            
            let targetUsername = targetInput;
            if (mode === 'feed') targetUsername = 'feed';
            else if (mode === 'explore') targetUsername = 'explore';
            else if (mode === 'hashtag') {
                if (!hashtags.length) { alert('Please enter at least one hashtag'); loading.classList.remove('active'); return; }
                targetUsername = `#${hashtags[0]}`;
            } else if (mode === 'location') {
                if (!locationPath) { alert('Please enter a location path'); loading.classList.remove('active'); return; }
                targetUsername = `location:${locationPath}`;
            } else if (mode === 'competitor_followers') {
                if (!competitorUsername) { alert('Please enter a competitor username'); loading.classList.remove('active'); return; }
                targetUsername = undefined;
            }
            
            const payload = {
                targetUsername, maxPosts, mode,
                options: {
                    mode,
                    hashtags: hashtags.length ? hashtags : undefined,
                    locationPath: locationPath || undefined,
                    competitorUsername: competitorUsername || undefined,
                    engagement: { minLikes: isNaN(minLikes) ? undefined : minLikes, minComments: isNaN(minComments) ? undefined : minComments },
                    englishOnly: englishOnly || undefined
                }
            };
            
            addLog(`üöÄ Starting ${mode} campaign (${maxPosts} posts)...`);
            const result = await apiCall('/api/interact', 'POST', payload);
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå Error: ' + result.error : '‚úÖ ' + result.message);
        }
        
        // Watch stories
        async function watchStories() {
            const loading = document.getElementById('loadingStories');
            loading.classList.add('active');
            
            const count = parseInt(document.getElementById('storyCount').value, 10) || 10;
            const target = document.getElementById('storyTarget').value.trim();
            const likeProb = parseFloat(document.getElementById('storyLikeProbability').value) / 100 || 0.3;
            const reactProb = parseFloat(document.getElementById('storyReactionProbability').value) / 100 || 0.2;
            const emoji = document.getElementById('storyReactionEmoji').value.trim() || 'üî•';
            const minWatch = parseFloat(document.getElementById('storyMinWatch').value) * 1000 || 5000;
            const maxWatch = parseFloat(document.getElementById('storyMaxWatch').value) * 1000 || 9000;
            const aiEnabled = document.getElementById('storyAiReplyEnabled').checked;
            
            const payload = {
                storyCount: count,
                targetUsername: target || undefined,
                likeProbability: likeProb,
                reactionProbability: reactProb,
                reactionEmoji: emoji,
                minWatchTimeMs: minWatch,
                maxWatchTimeMs: maxWatch
            };
            
            if (aiEnabled) {
                payload.aiReply = {
                    enabled: true,
                    maxReplies: parseInt(document.getElementById('storyAiMaxReplies').value, 10),
                    tone: document.getElementById('storyAiTone').value,
                    minConfidence: parseFloat(document.getElementById('storyAiConfidence').value) / 100
                };
            }
            
            addLog(`üëÅÔ∏è Watching ${count} stories...`);
            const result = await apiCall('/api/stories/watch', 'POST', payload);
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå Error: ' + result.error : '‚úÖ ' + result.message);
        }
        
        // Send DM
        async function sendDM() {
            const username = document.getElementById('dmUsername').value.trim();
            const message = document.getElementById('dmMessage').value.trim();
            if (!username || !message) { alert('Please fill in both username and message'); return; }
            
            const loading = document.getElementById('loading2');
            loading.classList.add('active');
            addLog(`üì© Sending DM to @${username}...`);
            
            const result = await apiCall('/api/dm', 'POST', { username, message });
            loading.classList.remove('active');
            
            if (result.error) {
                addLog('‚ùå Error: ' + result.error);
            } else {
                addLog('‚úÖ DM sent to @' + username);
                document.getElementById('dmUsername').value = '';
                document.getElementById('dmMessage').value = '';
            }
        }
        
        // Monitor DMs
        async function monitorDMs() {
            const loading = document.getElementById('loading2');
            loading.classList.add('active');
            addLog('üì¨ Monitoring DMs...');
            const result = await apiCall('/api/monitor-dms', 'POST');
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå Error: ' + result.error : '‚úÖ ' + result.message);
        }
        
        async function clearDMCache() {
            if (!confirm('Clear the replied conversations cache? This will allow the bot to reply to previously-handled DMs again.')) {
                return;
            }
            
            addLog('üóëÔ∏è Clearing replied conversations cache...');
            const result = await apiCall('/api/dms/clear-cache', 'POST');
            
            if (result.error) {
                addLog('‚ùå Error: ' + result.error);
            } else {
                addLog('‚úÖ ' + result.message);
            }
        }

        async function scrapeFollowers() {
            const targetAccount = document.getElementById('targetAccount').value.trim();
            const maxFollowers = parseInt(document.getElementById('maxFollowers').value);
            if (!targetAccount) { alert('Please enter a target account'); return; }
            
            const loading = document.getElementById('loading4');
            loading.classList.add('active');
            addLog(`üë• Scraping followers from @${targetAccount}...`);
            
            const result = await apiCall('/api/scrape-followers', 'POST', { targetAccount, maxFollowers });
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå Error: ' + result.error : `‚úÖ Scraped ${result.followers?.length || 0} followers`);
        }
        
        // Check scheduler
        async function checkScheduler() {
            const loading = document.getElementById('loading4');
            loading.classList.add('active');
            const result = await apiCall('/api/scheduler/status');
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå ' + result.error : `‚è∞ Scheduler: ${result.isRunning ? 'Running ‚úÖ' : 'Stopped ‚ùå'}`);
        }
        
        // Get profile
        async function getMyProfile() {
            const loading = document.getElementById('loading4');
            loading.classList.add('active');
            const result = await apiCall('/api/me');
            loading.classList.remove('active');
            addLog(result.error ? '‚ùå ' + result.error : `üë§ Username: ${result.username || 'Unknown'}`);
        }
        
        // Load screenshots
        async function loadScreenshots() {
            const gallery = document.getElementById('screenshotGallery');
            gallery.innerHTML = '<p style="text-align: center; padding: 20px;">Loading...</p>';
            toggleCollapsible('screenshotGallery');
            
            const result = await apiCall('/api/screenshots/list');
            
            if (result.error || !result.screenshots || result.screenshots.length === 0) {
                gallery.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 20px;">No screenshots found</p>';
                return;
            }
            
            const target = document.getElementById('targetUsername').value.trim();
            const maxPosts = parseInt(document.getElementById('maxPosts').value) || 10;
            
            document.getElementById('statusMessage').textContent = `Starting ${type} interaction...`;
            
            const result = await apiCall('/api/interact', 'POST', {
                targetUsername: target || null,
                maxPosts: maxPosts,
                mode: type
            });
            
            if (result.error) {
                document.getElementById('statusMessage').textContent = 'Error: ' + result.error;
            } else {
                document.getElementById('statusMessage').textContent = result.message || 'Interaction started!';
                startCountdown(60);
            }
        }
        
        // Start campaign
        async function startCampaign() {
            const target = document.getElementById('targetUsername').value.trim();
            if (!target) {
                alert('Please enter a target username');
                return;
            }
            await startInteraction('like');
        }
        
        async function viewLogs() {
            const result = await apiCall('/api/logs/recent?lines=1000'); // Increased from 500 to 1000
            
            document.getElementById('statusMessage').textContent = 'Viewing stories...';
            const result = await apiCall('/api/stories/view', 'POST');
            
            if (result.error) {
                document.getElementById('statusMessage').textContent = 'Error: ' + result.error;
            } else {
                document.getElementById('statusMessage').textContent = result.message || 'Stories viewed!';
            }
        }
        
        // Countdown
        function startCountdown(seconds) {
            if (countdownInterval) clearInterval(countdownInterval);
            
            let remaining = seconds;
            const countdownEl = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                remaining--;
                countdownEl.textContent = remaining + ' seconds till next action';
                
                if (remaining <= 0) {
                    clearInterval(countdownInterval);
                    countdownEl.textContent = 'Ready';
                }
            }, 1000);
        }
        
        // Logs
        async function refreshLogs() {
            const result = await apiCall('/api/logs/recent?lines=100');
            if (result.error) {
                console.error('Log fetch error:', result.error);
                return;
            }
            
            const logs = document.getElementById('logs');
            let lines = result.logs || [];
            
            // Filter based on detail level
            const detailLevel = document.getElementById('logDetailLevel')?.value || 'all';
            if (detailLevel === 'important') {
                // Only show important logs (errors, successes, major actions)
                lines = lines.filter(line => {
                    return line.includes('‚úÖ') || line.includes('‚ùå') || line.includes('‚ö†Ô∏è') ||
                           line.includes('error:') || line.includes('Successfully') ||
                           line.includes('Starting') || line.includes('Complete') ||
                           line.includes('Liked story') || line.includes('AI replied') ||
                           line.includes('Reply sent') || line.includes('Campaign') ||
                           line.includes('logged in') || line.includes('Failed');
                });
            }
            
            // Clear existing logs and add new ones
            logs.innerHTML = '';
            if (lines.length === 0) {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                if (line.includes('‚úÖ') || line.includes('Successfully')) entry.classList.add('log-success');
                else if (line.includes('‚ùå') || line.includes('error:')) entry.classList.add('log-error');
                else if (line.includes('‚ö†Ô∏è') || line.includes('warn:')) entry.classList.add('log-warning');
                else if (line.includes('info:')) entry.classList.add('log-info');
                entry.textContent = line;
                logs.appendChild(entry);
            } else {
                // Show newest first (reverse the array)
                lines.reverse().forEach(line => {
                    const entry = document.createElement('div');
                    entry.className = 'log-entry';
                    
                    // Enhanced color coding to match terminal output
                    if (line.includes('‚úÖ') || line.includes('Successfully') || line.includes('liked') || line.includes('Comment posted') || 
                        line.includes('Liked story') || line.includes('‚ù§Ô∏è') || line.includes('Reply sent') || 
                        line.includes('Story reply sent') || line.includes('AI replied')) {
                        entry.classList.add('log-success');
                    } else if (line.includes('‚ùå') || line.includes('error:') || line.includes('Error') || 
                               line.includes('failed') || line.includes('Failed') || line.includes('timeout')) {
                        entry.classList.add('log-error');
                    } else if (line.includes('‚ö†Ô∏è') || line.includes('warn:') || line.includes('Warning') || 
                               line.includes('Skipping') || line.includes('No dismissal') || line.includes('Unable to')) {
                        entry.classList.add('log-warning');
                    } else if (line.includes('info:') || line.includes('üì°') || line.includes('üìç') || 
                               line.includes('üîç') || line.includes('üì∏') || line.includes('üì©') || 
                               line.includes('üéûÔ∏è') || line.includes('Starting story') || line.includes('Watching') ||
                               line.includes('Checking for') || line.includes('Notification') || 
                               line.includes('screenshot saved') || line.includes('Saved screenshot') ||
                               line.includes('Loaded cookies') || line.includes('logged in') ||
                               line.includes('Navigating') || line.includes('Opening') ||
                               line.includes('üí¨') || line.includes('Attempting to') || line.includes('Found story')) {
                        entry.classList.add('log-info');
                    } else if (line.includes('ü§ñ') || line.includes('AI Story Analysis') || 
                               line.includes('AI Generated') || line.includes('confidence')) {
                        entry.classList.add('log-info');
                        entry.style.backgroundColor = '#f0f9ff'; // Light blue for AI logs
                        entry.style.borderLeft = '3px solid #3b82f6';
                    }
                    
                    entry.textContent = line;
                    logs.appendChild(entry);
                });
            }
            
            // Update log count
            const logCount = document.getElementById('logCount');
            logCount.textContent = `(${lines.length} lines)`;
            
            // Auto-scroll to bottom (newest logs)
            logs.scrollTop = logs.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function filterLogs(level) {
            document.querySelectorAll('.log-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (level === 'all') {
                renderLogs(cachedLogs);
            } else {
                renderLogs(cachedLogs.filter(l => l.level === level));
            }
        }
        
        function downloadLogs() {
            if (cachedLogs.length === 0) {
                alert('No logs to download');
                return;
            }
            
            const text = cachedLogs.map(l => `[${l.timestamp}] [${l.level}] ${l.message}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `riona-logs-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
        }
        
        function toggleLiveLog() {
            const btn = document.getElementById('liveLogBtn');
            if (logRefreshInterval) {
                clearInterval(logRefreshInterval);
                logRefreshInterval = null;
                btn.textContent = '‚ñ∂Ô∏è Live';
                btn.className = 'btn-success btn-sm';
            } else {
                // Start live refresh
                viewLogs(); // Fetch immediately
                logRefreshInterval = setInterval(viewLogs, 2000); // Refresh every 2 seconds (faster)
                btn.textContent = '‚è∏Ô∏è Stop Live Log';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-danger');
                addLog('‚ñ∂Ô∏è Live log started (updates every 2s)');
            }
        });
        
        document.getElementById('targetAccounts')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const account = this.value.trim().replace(/^@/, '');
                if (account) {
                    const container = document.getElementById('accountsList');
                    const tagEl = document.createElement('div');
                    tagEl.className = 'hashtag-tag';
                    tagEl.innerHTML = `<span>@</span><span>${account}</span><span class="hashtag-remove" onclick="removeHashtag(this)">√ó</span>`;
                    container.appendChild(tagEl);
                    this.value = '';
                }
            }
        });
        
        // Load saved username
        window.onload = () => {
            checkStatus();
            updateInteractionFields();
            
            // Auto-fill username if previously saved
            const savedUsername = localStorage.getItem('savedUsername');
            if (savedUsername) {
                const usernameInput = document.getElementById('loginUsername');
                if (usernameInput) {
                    usernameInput.value = savedUsername;
                }
            }
            loadProxySettings();
            viewLogs(); // Load logs on startup
            
            const savedUsername = localStorage.getItem('savedUsername');
            if (savedUsername) document.getElementById('loginUsername').value = savedUsername;
            
            document.getElementById('proxyEnabled').addEventListener('change', toggleProxyFields);
            document.getElementById('storyAiReplyEnabled').addEventListener('change', toggleStoryAiOptions);
            toggleStoryAiOptions();

            const aiInput = document.getElementById('aiCommandInput');
            if (aiInput) {
                aiInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' && !event.shiftKey) {
                        event.preventDefault();
                        sendAiCommand();
                    }
                });
            }
            
            addLog('ü§ñ Dashboard loaded');
        };
        
        // Periodic status check
        setInterval(checkStatus, 30000);
    </script>
</body>
</html>
